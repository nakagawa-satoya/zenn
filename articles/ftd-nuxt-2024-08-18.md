---
title: "v-tokyo #21 ã®è©±ã‚’èã„ã¦ã€Nuxt4 ã¸ç§»è¡Œï¼....ã§ããªã‹ã£ãŸã®ã§å‰æº–å‚™"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [vuejs,codemod,nuxt,nuxt3,nuxt4]
published: true
publication_name: ftd_tech_blog
---
# v-tokyo #21 ã®è©±ã‚’èã„ã¦ã€Nuxt4 ã¸ç§»è¡Œã—ã¦ã¿ã‚ˆã†ã¨æ€ã£ãŸã‚‰ã€ã§ããªã‹ã£ãŸã®ã§æº–å‚™ã ã‘ã—ãŸè©±
## ã¯ã˜ã‚ã«
v-tokyo #21 ã§èã„ãŸ Nuxt4 ã¸ã®ä»¥é™ã®è©±ãŒçµæ§‹é¢ç™½ã‹ã£ãŸã®ã§ã€ç§»è¡Œã—ã¦ã¿ã‚‹ã€‚

https://twitter.com/pontaxx/status/1817722298864128298

:::message alert
ç§»è¡Œã—ã¦ã„ã‚‹é¢¨ã§ã™ãŒã€é€”ä¸­ã§Nuxt4ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ°—ã¥ã„ãŸã®ã§ã€compatibilityVersion ã‚’ã‚»ãƒƒãƒˆã—ã¦å¯¾å¿œã—ã¾ã—ãŸã€‚
ã“ã‚Œã§ã„ã¤ã§ã‚‚ver up OKï¼
:::

## ç¾è¡Œç’°å¢ƒ
```json file:package.json
    "nuxt": "^3.10.3",
    "vite": "5.1.4",
    "vue": "^3.4.3",
```
# ç§»è¡Œæ‰‹é †
ã“ã¡ã‚‰ã‚’å‚è€ƒã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€²ã‚ã‚‹ã€‚
https://nuxt.com/docs/getting-started/upgrade#migrating-to-nuxt-4

### ã‚ã‚Œï¼Ÿï¼Ÿ ã¾ã ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ãªã„ã®ã‹
> Nuxt 4 is planned to be released on or before June 14 (though obviously this is dependent on having enough time after Nitro's major release to be properly tested in the community, so be aware that this is not an exact date).
> Until then, it is possible to test many of Nuxt 4's breaking changes from Nuxt version 3.12+.

### PRã¯ä¸ŠãŒã£ã¦ã„ã‚‹
https://github.com/nuxt/nuxt/pull/27716
:::message
ã‚‚ã†å°‘ã—ã ã¨ä¿¡ã˜ãŸã„ï¼é ‘å¼µã£ã¦ãã‚Œ
:::


## compatibilityVersion ã‚’ã‚»ãƒƒãƒˆ
```json file:nuxt.config.ts
export default defineNuxtConfig({
  future: {
    compatibilityVersion: 4,
  },
  // To re-enable _all_ Nuxt v3 behavior, set the following options:
  // srcDir: '.',
  // dir: {
  //   app: 'app'
  // },
  // experimental: {
  //   sharedPrerenderData: false,
  //   compileTemplate: true,
  //   resetAsyncDataToUndefined: true,
  //   templateUtils: true,
  //   relativeWatchPaths: true,
  //   defaults: {
  //     useAsyncData: {
  //       deep: true
  //     }
  //   }
  // },
  // unhead: {
  //   renderSSRHeadOptions: {
  //     omitLineBreaks: false
  //   }
  // }
})

```

## Nuxt3 ã‚’3.12ä»¥ä¸Šã«
v3.12 ä»¥ä¸ŠãŒå¿…è¦ã¨ã®ã“ã¨ãªã®ã§ã€æœ€æ–°ã®Nuxt3ã«ã™ã‚‹ã€‚

```Bash
npx nuxi upgrade
```

```json file:package.json(npx nuxi upgradeå¾Œ)
    "nuxt": "^3.12.4",
```

## run dev ã—ã¦ nuxt.config ã‚’æ›´æ–°
```bash file:(run dev compatibilityDateã‚’èã‹ã‚Œã‚‹)
âœ” Do you want to update your nuxt.config to set compatibilityDate: '2024-08-18'?
Yes
âœ” Compatibility date set to 2024-08-18 in nuxt.config.ts                                                                                                                                                              9:57:47 AM
â„¹ nuxt.config.ts updated. Restarting Nuxt...                  
```
å°‹ã­ã‚‰ã‚ŒãŸã®ã§ã€Yes ã§æ›´æ–°ã€‚

### compatibilityDate
https://nuxt.com/docs/api/nuxt-config#compatibilitydate

#### åŸæ–‡
> Specify a compatibility date for your app.
> This is used to control the behavior of presets in Nitro, Nuxt Image and other modules that may change behavior without a major version bump. We plan to improve the tooling around this feature in the future.

è¦ã™ã‚‹ã«ã‚¢ãƒ—ãƒªã®äº’æ›æ€§æ—¥ä»˜ã‚’æŒ‡å®šã™ã‚‹æ©Ÿèƒ½ã€‚ç‰¹ã«æŒ‡å®šã—ãªãã¦ã‚‚è‰¯ã„ãŒã€å›ºå®šã—ã¦ãŠã„ãŸæ–¹ãŒå¾Œã€…ãƒˆãƒ©ãƒ–ãƒ«ãŒãªã„ã‹ã‚‚

:::message
ãªã‚‹ã»ã©ï¼Ÿä½•ã«å¿…è¦ã«ãªã‚‹ã®ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„ãŒã€ã¨ã‚Šã‚ãˆãšè¨­å®šã—ã¦ãŠã
:::

## Codemod
```Bash
npx codemod@latest nuxt/4/migration-recipe
```

https://codemod.com/registry/nuxt-4-migration-recipe

wattanx ã•ã‚“ã®è¨˜äº‹ã®`nuxt/4/shallow-function-reactivity` ã¯ã“ã¡ã‚‰ã‹ã‚‰é¸æŠã™ã‚‹ã¿ãŸã„ã§ã™ã€‚


### ãã®ã»ã‹ã®é¸æŠè‚¢
1. nuxt/4/absolute-watch-path 
2. nuxt/4/default-data-error-value
3. nuxt/4/deprecated-dedupe-value
4. nuxt/4/file-structure 
   - v3ã‹ã‚‰v4 ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«å¤‰æ›´ã—ã¦ãã‚Œã‚‹
5. nuxt/4/template-compilation-changes

:::message
nuxt/4/shallow-function-reactivityã‚’å®Ÿè¡Œã—ã¦ã¿ã‚Œã°ã‚ã‹ã‚‹ãŒã€nuxt/4/template-compilation-changes ä»¥å¤–ã¯ å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€
nuxt/4/shallow-function-reactivityã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§OK
:::

::::details å®Ÿè¡Œãƒ­ã‚°
```Bash
% npx codemod@latest nuxt/4/migration-recipe
Need to install the following packages:
codemod@0.13.7
Ok to proceed? (y) y

âœ” Successfully downloaded "nuxt/4/migration-recipe" from the registry.
? Select the codemods you would like to run. Codemods will be executed in order. nuxt/4/absolute-watch-path, nuxt/4/default-data-error-value, nuxt/4/deprecated-dedupe-value, nuxt/4/file-structure, 
nuxt/4/shallow-function-reactivity, nuxt/4/template-compilation-changes
âœ” Successfully fetched recipe codemods.
? Current git state contains uncommitted changes. Proceed anyway? Yes
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                                         â”‚
â”‚                                                                                                         â”‚
â”‚      Codemod: nuxt/4/absolute-watch-path@1.0.3                                                          â”‚
â”‚      Target: /Volumes/Extreme Pro/market/frontend                                                       â”‚
â”‚                                                                                                         â”‚
â”‚      Using paths provided by codemod settings                                                           â”‚
â”‚      Included patterns: **/*.js, **/*.jsx, **/*.ts, **/*.tsx, **/*.vue                                  â”‚
â”‚      Patterns excluded by default: **/*.d.ts, **/node_modules/**/*.*, **/.next/**/*.*,                  â”‚
â”‚      **/dist/**/*.*, **/build/**/*.*, **/.git/**/*.*,                                                   â”‚
â”‚      **/.svn/**/*.*, **/.hg/**/*.*, **/.bzr/**/*.*,                                                     â”‚
â”‚      **/_darcs/**/*.*, **/_MTN/**/*.*, **/_FOSSIL_, **/.fslckout,                                       â”‚
â”‚      **/.view/**/*.*                                                                                    â”‚
â”‚      Patterns excluded from gitignore: **/node_modules, **/*.log*, **/.nuxt, **/.nitro, **/.cache,      â”‚
â”‚      **/.output, **/.env, **/dist, **/.idea, **/.data,                                                  â”‚
â”‚      **/lint/*.xml, **/.yarn/*, **/!.yarn/cache,                                                        â”‚
â”‚      **/!.yarn/patches, **/!.yarn/plugins, **/!.yarn/releases,                                          â”‚
â”‚      **/!.yarn/sdks, **/!.yarn/versions                                                                 â”‚
â”‚                                                                                                         â”‚
â”‚      Running in 4 threads                                                                               â”‚
â”‚      File formatting disabled                                                                           â”‚
â”‚                                                                                                         â”‚
â”‚                                                                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
Execution progress | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 100% || 262/262 files || Current: storybook-static/assets/DocsRenderer-3PUGWF3O-90442d51.js
Execution progress | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 100% || 262/262 files || Current: public/storybook-static/vendors~main.d6ea56a1c8b964085fc4.manager.bundle.js
Execution progress | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 100% || 262/262 files || Current: public/storybook-static/vendors~main.d6ea56a1c8b964085fc4.manager.bundle.js
Execution progress | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 100% || 262/262 files || Current: storybook-static/storybook/storybook-static/vendors~main.d6ea56a1c8b964085fc4.manager.bundle.js
Execution progress | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 100% || 262/262 files || Current: storybook-static/storybook-static/assets/iframe-f5211697.js
```
::::

## Codemod å¾Œã«
srcDir ãªã©è‰²ã€…å¤‰æ›´ã—ã¦ã„ã‚‹äººã¯ã€å¯¾å¿œãŒå¿…è¦ãªã‚ˆã†ãªã®ã§ã€ã“ã¡ã‚‰ã‚’å‚è€ƒã«
https://zenn.dev/shun91/articles/nuxt4-planned-changes

:::message
ãƒ«ãƒ¼ãƒˆã®å¤‰æ›´ã®ã¿ã§ã—ãŸãŒã€ã“ã“ãŒä¸€ç•ªæ™‚é–“ã‹ã‹ã‚Šã¾ã—ãŸã€‚
:::

## Nuxt4ãŒæ¥ãŸã‚‰
```bash
npx nuxi upgrade
```

Done! ã¨ãªã£ã¦çµ‚ã‚ã‚‹ã¯ãš

## ãŠã‚ã‚Šã«
ã‚µã‚¯ãƒƒã¨çµ‚ã‚ã‚Šã¾ã—ãŸã€‚Nuxt4 ã¯æ€–ããªã„ï¼

:::message
Nuxt4 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã‚‰ã€ã¾ãŸç§»è¡Œã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
:::
